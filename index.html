<button type="button" id="btn">CLICK TO RECORD</button>
<button type="button" id="playback">CLICK TO PLAYBACK</button>

<p>Each row's leftmost letters is an octave, press shift to change to be flat notes!</p>
<script src="https://tonejs.github.io/build/Tone.js"></script>
<script>
  /* global Tone */
  const notes = [
    'C','D','E','F','G','A','B'
  ]
  
  const flat_notes = [
    'Cb','Db','Eb','Fb','Gb','Ab','Bb'
  ]
  
  ///(Math.round(Math.random()*16)+1).toString()+'n'
  //let count = 0 
  let on = 0
  
  function play (e) {
    const synth = new Tone.Synth().toDestination()
    if (on===0) {
    	if ('zxcvbnm'.indexOf(e) > -1){
      	synth.triggerAttackRelease(notes['zxcvbnm'.indexOf(e)]+'3', ('8n'))
      	}
    	if ('asdfghj'.indexOf(e) > -1){
      	synth.triggerAttackRelease(notes['asdfghj'.indexOf(e)]+'4', ('8n'))
      	}
    	if ('qwertyu'.indexOf(e) > -1){
     	 synth.triggerAttackRelease(notes['qwertyu'.indexOf(e)]+'5', ('8n'))
      	}
    	}
    else {
      if ('zxcvbnm'.indexOf(e) > -1){
      	synth.triggerAttackRelease(flat_notes['zxcvbnm'.indexOf(e)]+'3', ('8n'))
      	}
    	if ('asdfghj'.indexOf(e) > -1){
      	synth.triggerAttackRelease(flat_notes['asdfghj'.indexOf(e)]+'4', ('8n'))
      	}
    	if ('qwertyu'.indexOf(e) > -1){
     	 synth.triggerAttackRelease(flat_notes['qwertyu'.indexOf(e)]+'5', ('8n'))
      	}
    	}
    }

  
//  function start () {
  
    //Tone.Transport.scheduleRepeat(play, '4n') 
    //Tone.Transport.bpm.value = 250
    //Tone.Transport.start()
   // }
  let notes_played = ''
  let time_played = []
  let time_played_difference = []
  let should_record = false
  
  function record () {
    if (should_record === false) {
      should_record = true
    }
    else {
      should_record = false
    }
    console.log(should_record)
  }
  
  const btn = document.querySelector("#btn")
  btn.addEventListener('click', record)
  
  document.addEventListener("keydown", (event) => { 
    if(event.shiftKey === true) {
      if (on===0) {
        on += 1
      	console.log(on)
      }
      else {
        on = 0
        console.log(on)
      }
    }
    play(event.key)
    if (should_record === true){
      notes_played += event.key
      time_played.push(Tone.now())
    }
    return
	
})

function playback() {
  if (time_played_difference !== []) {
    time_played_difference = []
  }
  for (let j = 0; j < time_played.length; j++){
    if (j===0){
      time_played_difference.push(0)
    }
    else {
      time_played_difference.push(time_played[j]-time_played[j-1]+time_played_difference[j-1])
    }
  	//console.log(time_played_difference)
	}
  time_played = []
  let now = Tone.now()
  for (let i = 0; i<notes_played.length; i++){
			const synth = new Tone.Synth().toDestination()
    	if ('zxcvbnm'.indexOf(notes_played[i]) > -1){
      	synth.triggerAttackRelease(notes['zxcvbnm'.indexOf(notes_played[i])]+'3', ('8n'),now+time_played_difference[i])
      	}
    	if ('asdfghj'.indexOf(notes_played[i]) > -1){
     		synth.triggerAttackRelease(notes['asdfghj'.indexOf(notes_played[i])]+'4', ('8n'),now+time_played_difference[i])
      	}
    	if ('qwertyu'.indexOf(notes_played[i]) > -1){
     		synth.triggerAttackRelease(notes['qwertyu'.indexOf(notes_played[i])]+'5', ('8n'),now+time_played_difference[i])
      	}
    	}
  	notes_played = ''
  }


const playing = document.querySelector("#playback")
playing.addEventListener('click', playback)
  
</script>